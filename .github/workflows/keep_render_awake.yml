name: Keep Render App Awake (Mon‚ÄìFri, 8 AM‚Äì8 PM CAT)

on:
  schedule:
    # Run every 10 minutes, Monday‚ÄìFriday, 6:00‚Äì18:00 UTC (8 AM‚Äì8 PM CAT)
    - cron: "*/13 5-15 * * 1-5"
  workflow_dispatch:  # allows manual trigger from GitHub UI

jobs:
  ping-render:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Render App and Log Response
        run: |
          APP_URL="https://micro-finance-beo1.onrender.com/"
          echo "==========================================="
          echo "üïí Starting Render ping at $(date -u)"
          echo "Target URL: $APP_URL"
          echo "-------------------------------------------"

          # Random delay (to prevent overlap)
          delay=$((RANDOM % 60))
          echo "Waiting $delay seconds before ping..."
          sleep $delay

          # Ping app and capture response code
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" "$APP_URL")

          if [ "$RESPONSE" -eq 200 ]; then
            echo "‚úÖ SUCCESS: App responded with HTTP 200"
          elif [ "$RESPONSE" -eq 301 ] || [ "$RESPONSE" -eq 302 ]; then
            echo "‚ö†Ô∏è REDIRECT: App responded with HTTP $RESPONSE"
          elif [ "$RESPONSE" -eq 000 ]; then
            echo "‚ùå ERROR: Could not connect (possibly sleeping)"
          else
            echo "‚ö†Ô∏è UNEXPECTED RESPONSE: HTTP $RESPONSE"
          fi

          echo "Ping completed at $(date -u)"
          echo "==========================================="
